<!DOCTYPE html>
<html lang="en">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Kylo Yip">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Kylo Yip">
    
        <meta name="keywords" content="Kylo's Notebook,Kylo Yip">
    
    <meta name="description" content="">
    <meta name="description" content="学会 Linux 系统原理，并使用命令行工具分析 Linux 系统问题（网络）。">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 网络原理与分析">
<meta property="og:url" content="https://yipwinghong.github.io/2021/04/05/OS_linux-network-monitoring/index.html">
<meta property="og:site_name" content="Kylo&#39;s Notebook">
<meta property="og:description" content="学会 Linux 系统原理，并使用命令行工具分析 Linux 系统问题（网络）。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/3af644b6d463869ece19786a4634f765.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/PR-3303.png">
<meta property="og:image" content="http://www.iovisor.org/wp-content/uploads/sites/8/2016/09/xdp-packet-processing-1024x560.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/c072bb9c9dfd727ed187bc24beb3e3d1.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/a1eb07e281e5795be83c11d7255c543b.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/0d87b39b89a1b7f325fc5477c0182ea0.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/5f2d4957663dd8bf3410da8180ab18f0.png">
<meta property="og:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/b07ea76a8737ed93395736795ede44e0.png">
<meta property="article:published_time" content="2021-04-05T07:50:33.000Z">
<meta property="article:modified_time" content="2021-07-20T02:20:24.637Z">
<meta property="article:author" content="Kylo Yip">
<meta property="article:tag" content="技术">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="OS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/3af644b6d463869ece19786a4634f765.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    
    <title>Linux 网络原理与分析 · Kylo&#39;s Notebook</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20211217" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20211217" as="style">
    <link rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" href="/css/mobile.css?v=20211217" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20211217" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20211217" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Kylo's Notebook" type="application/atom+xml">
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>Kylo's Notebook</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">Kylo&#39;s Notebook</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">Linux 网络原理与分析</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:0vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(https://api.ixiaowai.cn/mcapi/mcapi.php)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                Linux 网络原理与分析
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="技术">技术</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="Linux">Linux</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="OS">OS</a>
    
</div>

                
                
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">8.6k</span>Reading time: <span class="post-count reading-time">33 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2021/04/05</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h1 id="Linux-网络原理与分析"><a href="#Linux-网络原理与分析" class="headerlink" title="Linux 网络原理与分析"></a>Linux 网络原理与分析</h1><blockquote>
<p>  本文侧重点在于讲解 Linux 内核协议栈网络相关的内容，而 TCP/IP 网络模型的内容不会过多提及。</p>
<p>  了解更多网络相关的原理知识请参考《计算机网络》。</p>
</blockquote>
<blockquote class="pullquote mindmap mindmap-md"><ul>
<li>网络性能指标<ul>
<li>应用层<ul>
<li>QPS（每秒请求数）</li>
<li>套接字缓冲区大小</li>
<li>DNS 响应延迟</li>
<li>响应时间</li>
<li>错误数</li>
</ul>
</li>
<li>传输层<ul>
<li>TCP 连接数<ul>
<li>全连接</li>
<li>半连接</li>
<li>TIMEWAIT</li>
</ul>
</li>
<li>连接跟踪数</li>
<li>重传数</li>
<li>丢包数</li>
<li>延迟</li>
</ul>
</li>
<li>网络层<ul>
<li>丢包数</li>
<li>TTL</li>
<li>拆包</li>
</ul>
</li>
<li>链路层<ul>
<li>PPS（每秒网络帧数）</li>
<li>BPS（每秒字节数）</li>
<li>丢包数</li>
<li>错误数</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h2><p><strong>OSI 网络模型</strong>：即来自国际标准化组织制定的开放式系统互联通信参考模型（Open System Interconnection Reference Model），分为七层，其各自负责：</p>
<ul>
<li><p>应用层：为应用程序提供统一的接口。</p>
</li>
<li><p>表示层：把数据转换成兼容接收系统的格式。</p>
</li>
<li><p>会话层：维护计算机之间的通信连接。</p>
</li>
<li><p>传输层：为数据加上传输表头，形成数据包。</p>
</li>
<li><p>网络层：数据的路由和转发。</p>
</li>
<li><p>数据链路层：MAC 寻址、错误侦测和改错。</p>
</li>
<li><p>物理层：在物理网络中传输数据帧。</p>
</li>
</ul>
<p><strong>TCP/IP 网络模型</strong>：Linux 中具体实现的四层网络模型。</p>
<ul>
<li><p>应用层：向用户提供一组应用程序，比如 HTTP、FTP、DNS 等。对应 OSI 模型的应用层、表示层和会话层。</p>
</li>
<li><p>传输层：端到端的通信，比如 TCP、UDP 等。</p>
</li>
<li><p>网络层：网络包的封装、寻址和路由，比如 IP、ICMP 等。</p>
</li>
<li><p>网络接口层：网络包在物理网络中的传输，比如 MAC 寻址、错误侦测以及通过网卡传输网络帧等。对应 OSI 模型的数据链路层和物理层。</p>
</li>
</ul>
<p>网络传输时，数据包会按照协议栈对上层数据逐层进行处理，然后封装该层的协议头，再发送给下一层（在原有的负载前后增加固定格式的元数据）。</p>
<p>由于物理链路中不能传输任意大小的数据包，网络接口配置的最大传输单元（MTU，以太网中默认值为 1500）规定了最大的 IP 包大小。</p>
<p>Linux 内核中的网络协议栈也类似 TCP/IP 的四层结构：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br><span class="line"><span class="comment">|</span>      <span class="comment">应用程序</span>       <span class="comment">|</span></span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br><span class="line"><span class="comment">|</span>      <span class="comment">系统调用</span>       <span class="comment">|</span></span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">+</span></span><br><span class="line">       <span class="comment">↓</span>     <span class="comment">|</span>  <span class="comment">VFS</span>  <span class="comment">|</span></span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">+</span>   </span><br><span class="line"><span class="comment">|</span>      <span class="comment">套接字</span>         <span class="comment">|</span></span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br><span class="line"><span class="comment">|</span> <span class="comment">TCP</span> <span class="comment">|</span> <span class="comment">UDP</span> <span class="comment">|</span>      <span class="literal">+</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br><span class="line"><span class="literal">+</span>--<span class="comment">↓</span>--<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span> <span class="comment">ICMP</span> <span class="comment">|</span></span><br><span class="line"><span class="comment">|</span>        <span class="comment">IP</span>        <span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span> <span class="comment">ARP</span>  <span class="comment">|</span></span><br><span class="line"><span class="comment">|</span>      <span class="comment">链路层</span>       <span class="comment">↓</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span> </span><br><span class="line"><span class="literal">+</span>--<span class="comment">↓</span>--<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">+</span></span><br><span class="line"><span class="comment">|</span> <span class="comment">igb</span> <span class="comment">|</span> <span class="string">.</span><span class="string">.</span><span class="string">.</span>  <span class="comment">|</span> <span class="comment">bnx</span> <span class="comment">|</span></span><br><span class="line"><span class="literal">+</span>--<span class="comment">↓</span>--<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="comment">↓</span>--<span class="literal">+</span></span><br><span class="line"><span class="comment">|</span> <span class="comment">网卡</span> <span class="comment">|</span> <span class="comment">网卡</span> <span class="comment">|</span> <span class="comment">网卡</span> <span class="comment">|</span> </span><br><span class="line"><span class="literal">+</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span></span><br></pre></td></tr></table></figure>
<p>其中网卡是发送和接收网络包的基本设备。在系统启动时，网卡通过内核中的网卡驱动程序注册到系统中。在网络收发过程中，内核通过中断与网卡进行交互。</p>
<h2 id="网络收发流程"><a href="#网络收发流程" class="headerlink" title="网络收发流程"></a>网络收发流程</h2><h3 id="网络包接收"><a href="#网络包接收" class="headerlink" title="网络包接收"></a>网络包接收</h3><p>网卡接收到网络帧：</p>
<ul>
<li><p>通过 DMA 把包放到收包队列中。</p>
</li>
<li><p>通过硬中断告知中断处理程序已收到网络包。</p>
</li>
<li><p>网卡中断处理程序为网络帧分配内核数据结构（sk_buff），将其拷贝到 sk_buff 缓冲区中。</p>
</li>
<li><p>通过软中断通知内核收到了新的网络帧。</p>
</li>
<li><p>内核协议栈从缓冲区中取出网络帧，通过网络协议栈从下到上逐层处理。</p>
</li>
</ul>
<blockquote>
<p>  DMA（Direct Memory Access）：在内存和 I/O 设备进行数据传输时，经过独立的协处理器（Co-Processor）DMAC（DMA Controller）辅助处理，而无需经过 CPU 控制。</p>
</blockquote>
<p>网络协议栈解析：</p>
<ul>
<li><p>链路层：检查报文合法性，找出上层协议类型（比如 IPv4），再去除帧头帧尾，交给网络层。</p>
</li>
<li><p>网络层：取出 IP 头，判断网络包下一步走向：交给上层处理或转发等。当确认这个包要发送到本机后，即取出上层协议类型（比如 TCP），去除 IP 头再交给传输层。</p>
</li>
<li><p>传输层：取出 TCP/UDP 头后，根据 <code>&lt;源 IP、源端口、目的 IP、目的端口&gt;</code> 四元组作为标识，并把数据拷贝到对应的 Socket 的接收缓存中。</p>
</li>
</ul>
<p>随即应用程序可以通过 Socket 接口读取到新接收的数据。</p>
<h3 id="网络包发送"><a href="#网络包发送" class="headerlink" title="网络包发送"></a>网络包发送</h3><p>与接收相反，应用程序调用 Socket API（比如 <code>sendmsg</code>）发起系统调用发送网络包。</p>
<p>进入内核态的套接字层，把数据包放到 Socket 发送到缓冲区中。</p>
<p>网络协议栈从 Socket 发送缓冲区中取出数据包，再按照 TCP/IP 栈从上到下逐层处理：比如增加 TCP 头、IP 头，执行路由查找下一跳 IP、按照 MTU（Maximum Transmission Unit）分片等。</p>
<p>分片后的网络包再送到网络接口层进行物理地址寻址，以找到下一跳的 MAC 地址；再添加帧头和帧尾放到发包队列中。</p>
<p>随后发起软中断通知驱动程序，由驱动程序通过 DMA 从发包队列中读出网络帧，通过物理网卡把它发送出去。</p>
<h3 id="套接字"><a href="#套接字" class="headerlink" title="套接字"></a>套接字</h3><p>套接字可屏蔽 Linux 内核中不同协议的差异，为应用程序提供统一访问接口。</p>
<p>每个套接字都有读写缓冲区：</p>
<ul>
<li><p>读缓冲区缓存远端发来的数据，读缓冲区满就不能再接收新的数据。</p>
</li>
<li><p>写缓冲区缓存要发出去的数据，写缓冲区满，应用程序写操作就会被阻塞。</p>
</li>
</ul>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/3af644b6d463869ece19786a4634f765.png" alt="img"></p>
<h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><p>分析网络问题常参考以下指标：</p>
<ul>
<li><p>带宽：链路的最大传输速率，单位通常为 b/s。常用带宽有 1000M、10G、40G、100G 等。</p>
</li>
<li><p>吞吐量：表示单位时间内成功传输的数据量，单位通常为 b/s（比特 / 秒）或者 B/s（字节 / 秒）。其受带宽限制，网络的使用率 == 吞吐量 / 带宽。</p>
</li>
<li><p>延时：表示从网络请求发出后一直到收到远端响应所需的时间。可以表示为建立连接需要的时间（比如 TCP 握手延时），或一个数据包往返所需的时间（比如 RTT）等。</p>
</li>
<li><p>传输速率：一般以 PPS（Packet Per Second，包 / 秒）衡量，即以网络包为单位的传输速率，常用于评估网络转发能力，比如硬件交换机通常可以达到线性转发（即 PPS 可以达到或者接近理论最大值），基于 Linux 服务器的转发则容易受网络包大小的影响；而对 TCP 或 Web 服务，更多会用并发连接数和每秒请求数（QPS，Query per Second）等指标反映实际应用程序的性能。</p>
</li>
</ul>
<p>其中带宽跟物理网卡配置是直接关联的，只是实际带宽会受限于整个网络链路中最小的模块。而“网络带宽测试”实际上是测试吞吐量。</p>
<p>除此之外还关心网络可用性（网络能否正常通信）、并发连接数（TCP 连接数量）、丢包率（丢包百分比）、重传率（重新传输的网络包比例）等。</p>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>分析网络问题需要查看网络接口的配置状态，使用 <code>ifconfig</code>、<code>ip</code> 命令（net-tools/iproute2）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0</span><br><span class="line"><span class="meta">#</span><span class="bash">                               物理连通            MTU，因网络架构而作调整（比如 VXLAN 等）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</span></span><br><span class="line"><span class="meta">#</span><span class="bash">           IP 地址、子网掩码、MAC 地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       inet 10.240.0.30 netmask 255.240.0.0 broadcast 10.255.255.255</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       inet6 fe80::20d:3aff:fe07:cf2a prefixlen 64 scopeid 0x20&lt;link&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       ether 78:0d:3a:07:cf:3a txqueuelen 1000 (Ethernet)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">           收发字节数、包数、错误数和丢包情况：指标不为 0 时通常表示出现网络 I/O 问题。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       RX packets 40809142 bytes 9542369803 (9.5 GB)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       RX errors 0 dropped 0 overruns 0 frame 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       TX packets 32637401 bytes 4815573306 (4.8 GB)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</span></span><br><span class="line"></span><br><span class="line">ip -s addr show dev eth0</span><br><span class="line"><span class="meta">#</span><span class="bash">                                  网络连通</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   link/ether 78:0d:3a:07:cf:3a brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   inet 10.240.0.30/12 brd 10.255.255.255 scope global eth0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   inet6 fe80::20d:3aff:fe07:cf2a/64 scope link</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       valid_lft forever preferred_lft forever</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   RX: bytes packets errors dropped overrun mcast</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    9542432350 40809397 0       0       0       193</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   TX: bytes packets errors dropped carrier collsns</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    4815625265 32637658 0       0       0       0</span></span><br></pre></td></tr></table></figure>
<p>网络 I/O 异常状态：</p>
<ul>
<li><p>errors：错误数据包数，校验错误、帧同步错误等。</p>
</li>
<li><p>dropped：丢弃数据包数。数据包已经收到了 Ring Buffer，但因为内存不足等原因丢包。</p>
</li>
<li><p>overruns：超限数据包数。网络 I/O 速度过快，导致 Ring Buffer 中的数据包来不及处理（队列满）而导致的丢包；</p>
</li>
<li><p>carrier：发生 carrirer 错误的数据包数。比如双工模式不匹配、物理电缆出现问题等。</p>
</li>
<li><p>collisions：碰撞数据包数。</p>
</li>
</ul>
<h3 id="套接字信息"><a href="#套接字信息" class="headerlink" title="套接字信息"></a>套接字信息</h3><p>使用 <code>netstat</code>、<code>ss</code> 查看套接字信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -l 只显示监听套接字，-n 显示数字地址和端口，-p 显示进程信息</span></span><br><span class="line">netstat -nlp | head -n 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> Active Internet connections (only servers)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      840/systemd-resolve</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -l 只显示监听套接字，-t 只显示 TCP 套接字，-n 显示数字地址和端口，-p 表示显示进程信息</span></span><br><span class="line">ss -ltnp | head -n 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*        users:((<span class="string">&quot;systemd-resolve&quot;</span>,pid=840,fd=13))</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*        users:((<span class="string">&quot;sshd&quot;</span>,pid=1459,fd=3))</span></span><br></pre></td></tr></table></figure>
<p>如果接收队列（Recv-Q）和发送队列（Send-Q）的值不为 0，说明有网络包的堆积发生。当 Socket 的状态为： </p>
<ul>
<li><p>Established：Recv-Q 表示套接字缓冲未被应用程序取走的字节数（即接收队列长度），Send-Q 表示还没有被远端主机确认的字节数（即发送队列长度）。</p>
</li>
<li><p>Listening：Recv-Q 表示全连接队列的长度，Send-Q 表示全连接队列的最大长度。</p>
</li>
</ul>
<p><strong>全连接</strong>：服务器收到了客户端的 ACK、完成了 TCP 三次握手，然后把这个连接放到全连接队列中。全连接中的套接字还需要被 <code>accept()</code> 系统调用取走，服务器才可以开始真正处理客户端请求。</p>
<p><strong>半连接</strong>：未完成 TCP 三次握手的连接，服务器收到客户端 SYN 包后会把它放到半连接队列中，再向客户端发送 SYN+ACK 包。</p>
<h3 id="协议栈信息"><a href="#协议栈信息" class="headerlink" title="协议栈信息"></a>协议栈信息</h3><p>使用 <code>netstat</code> 或 <code>ss</code> 查看协议栈信息：包括 TCP 协议的主动连接、被动连接、失败重试、发送和接收的分段数量等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">netstat -s</span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Tcp:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     3244906 active connection openings</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     23143 passive connection openings</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     115732 failed connection attempts</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     2964 connection resets received</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     1 connections established</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     13025010 segments received</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     17606946 segments sent out</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     44438 segments retransmitted</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     42 bad segments received</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     5315 resets sent</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     InCsumErrors: 42</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"></span><br><span class="line">ss -s</span><br><span class="line"><span class="meta">#</span><span class="bash"> Total: 186 (kernel 1446)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP:   4 (estab 1, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Transport Total     IP        IPv6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> *    1446      -         -</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RAW    2         1         1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> UDP    2         2         0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP    4         3         1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br></pre></td></tr></table></figure>
<h3 id="网络质量统计信息"><a href="#网络质量统计信息" class="headerlink" title="网络质量统计信息"></a>网络质量统计信息</h3><p>使用 <code>sar</code> 可查看网络统计信息，比如网络接口（DEV）、网络接口错误（EDEV）、TCP、UDP、ICMP 等：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sar -n DEV 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux 4.15.0-1035-azure (ubuntu)   01/06/19   _x86_64_  (2 CPU)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                          接收和发送的 PPS      接收和发送的吞吐量    接收和发送的压缩数据包数          网络接口使用率</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 13:21:40        IFACE    rxpck/s   txpck/s    rxkB/s    txkB/s    rxcmp/s   txcmp/s    rxmcst/s   %ifutil</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 13:21:41         eth0     18.00     20.00      5.79      4.25      0.00      0.00        0.00      0.00</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 13:21:41      docker0      0.00      0.00      0.00      0.00      0.00      0.00        0.00      0.00</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 13:21:41           lo      0.00      0.00      0.00      0.00      0.00      0.00        0.00      0.00</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>  其中网络接口的使用率：半双工模式下为 (rxkB/s+txkB/s)/Bandwidth，全双工模式下为 max(rxkB/s, txkB/s)/Bandwidth。</p>
</blockquote>
<p>使用 <code>ethtool</code> 可查询带宽（单位 Gb/s 或 Mb/s，注意是比特）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ethtool eth0 | grep Speed</span><br><span class="line"><span class="meta">#</span><span class="bash">   Speed: 1000Mb/s</span></span><br></pre></td></tr></table></figure>
<p>使用基于 ICMP 协议的 <code>ping</code> 可测试远程主机的连通性和延时：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ping -c3 114.114.114.114</span><br><span class="line"><span class="meta">#</span><span class="bash"> PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每个 ICMP 请求的信息，包括 ICMP 序列号（icmp_seq）、TTL（生存时间，或者跳数）和往返延时。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 64 bytes from 114.114.114.114: icmp_seq=1 ttl=54 time=244 ms</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 64 bytes from 114.114.114.114: icmp_seq=2 ttl=47 time=244 ms</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 64 bytes from 114.114.114.114: icmp_seq=3 ttl=67 time=244 ms</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 三次 ICMP 请求汇总。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --- 114.114.114.114 ping statistics ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 packets transmitted, 3 received, 0% packet loss, time 2001ms</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rtt min/avg/max/mdev = 244.023/244.070/244.105/0.034 ms</span></span><br></pre></td></tr></table></figure>
<h2 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h2><p>从 C10K、C100K、C1000K、C10M 问题入手可以更好理解 Linux 网络工作原理。</p>
<p>从 C1000K 开始，依靠单机支撑就需要仔细考虑：</p>
<ul>
<li><p>从物理资源的角度：处理大量请求需要配备大内存、万兆网卡，以及基于多网卡绑定以承载大吞吐量。</p>
</li>
<li><p>从软件资源的角度：大量的连接也会占用大量的软件资源，如文件描述符、连接状态跟踪（CONNTRACK）、网络协议栈缓存（比如套接字读写缓存、TCP 读写缓存）等。</p>
</li>
<li><p>从优化的角度：中断处理处理成本也很高，需要多队列网卡、中断负载均衡、CPU 绑定、RPS/RFS（软中断负载均衡到多个 CPU 核上），以及将网络包的处理卸载（Offload）到网络设备（如 TSO/GSO、LRO/GRO、VXLAN OFFLOAD）等各种硬件和软件的优化。</p>
</li>
</ul>
<h3 id="I-O-模型优化"><a href="#I-O-模型优化" class="headerlink" title="I/O 模型优化"></a>I/O 模型优化</h3><p>当物理资源足够，首先考虑的是 I/O 模型：如何在一个线程内处理多个请求、如何节省资源地处理用户请求。</p>
<p>I/O 多路复用是著名的并发解决方案，其提供两种 I/O 事件通知方式：</p>
<ul>
<li><p><strong>水平触发</strong>：只要文件描述符可以非阻塞地执行 I/O 就会触发通知。即应用程序可随时检查文件描述符的状态，然后再根据状态进行 I/O 操作。</p>
</li>
<li><p><strong>边缘触发</strong>：只有在文件描述符的状态发生改变（I/O 请求达到）时才发送一次通知。此时应用程序需要尽可能多地执行 I/O，直到无法继续读写才可以停止。如果 I/O 没执行完，或因为某种原因未来得及处理，这次通知就会丢失。</p>
</li>
</ul>
<p>I/O 多路复用也有多种实现方法：</p>
<ul>
<li><p><strong>非阻塞 I/O + 水平触发通知</strong>：select 和 poll 从文件描述符列表中找出可以执行 I/O ，再进行真正的读写。由于 I/O 是非阻塞的，一个线程中就可以同时监控一批套接字文件描述符，达到单线程处理多请求的目的。但也存在以下问题：</p>
<ul>
<li><p>需要对文件描述符列表进行轮询，请求数多时会比较耗时。</p>
</li>
<li><p>select 使用固定长度的位相量表示文件描述符集合，有最大描述符数量的限制（32 位系统 1024）；轮询检查套接字状态，处理耗时 O(N)。</p>
</li>
<li><p>poll 使用不定长数组存放文件描述符，没有最大描述符数量的限制（只受系统文件描述符限制），但也需要轮询文件描述符列表。</p>
</li>
<li><p>调用 select 和 poll 时需要把文件描述符集合从用户空间传入内核空间，由内核修改后再传出到用户空间中，存在切换成本。</p>
</li>
</ul>
</li>
<li><p><strong>非阻塞 I/O + 边缘触发通知</strong>：Linux 2.6 新增的 epoll 使用 <strong>红黑树</strong> <strong>在内核中管理</strong> 文件描述符，不需要应用程序在每次操作时都传入传出；使用事件驱动机制，只关注有 I/O 事件发生的文件描述符，而不是轮询扫描整个集合。</p>
</li>
<li><p><strong>异步 I/O（Asynchronous I/O）</strong>：Linux 2.6 新增的异步 I/O 允许应用程序同时发起多个 I/O 操作，在 I/O 完成后系统以事件通知（比如信号或者回调函数）告知应用程序前来查询结果。然而在较长时间内都不完善（比如 glibc 提供的异步 I/O 库），且使用难度较高。</p>
</li>
</ul>
<h3 id="工作模型优化"><a href="#工作模型优化" class="headerlink" title="工作模型优化"></a>工作模型优化</h3><p>I/O 多路复用还可以结合不同工作模型使用：</p>
<h4 id="主进程-多个-worker-子进程"><a href="#主进程-多个-worker-子进程" class="headerlink" title="主进程 + 多个 worker 子进程"></a>主进程 + 多个 worker 子进程</h4><p>Nginx 反向代理的原理就是基于此：主进程用于初始化套接字，执行 <code>bind()</code> + <code>listen()</code> 后创建多个子进程、管理其生命周期，每个子进程都通过 <code>accept()</code> 或 <code>epoll_wait()</code> 来处理相同套接字。</p>
<blockquote>
<p>  惊群效应：当网络 I/O 事件发生时，多个进程被同时唤醒，但实际上只有一个进程来响应这个事件，其他被唤醒的进程都会重新休眠。<code>accept()</code>（Linux 2.6 中解决）和 <code>epoll_wait()</code>（Linux 4.5 中通过 EPOLLEXCLUSIVE 解决）。</p>
<p>  Nginx 在每个 worker 进程中增加全局锁（<code>accept_mutex</code>），worker 进程需要先竞争到锁才会加入到 epoll 中，确保只有一个 worker 子进程被唤醒。</p>
</blockquote>
<p>可以用线程代替进程：主线程负责套接字初始化和子线程状态的管理，而子线程则负责实际的请求处理。线程的调度和切换成本比较低，再进一步把 <code>epoll_wait()</code> 都放到主线程中，保证每次事件都只唤醒主线程，子线程只需负责后续的请求处理。</p>
<h4 id="监听到相同端口的多进程"><a href="#监听到相同端口的多进程" class="headerlink" title="监听到相同端口的多进程"></a>监听到相同端口的多进程</h4><p>所有的进程监听相同端口，并开启 <code>SO_REUSEPORT</code> 选项（Linux 3.9+），由内核将请求负载均衡到监听进程中。</p>
<p>内核确保只有一个进程被唤醒，不会出现惊群问题。</p>
<h3 id="DPDK-和-XDP"><a href="#DPDK-和-XDP" class="headerlink" title="DPDK 和 XDP"></a>DPDK 和 XDP</h3><p>在 C10M 问题中，单靠常规软硬件优化已经难以满足需求。</p>
<blockquote>
<p>  其根本原因是 Linux 内核协议栈工作太繁重：</p>
<p>  网卡硬中断 -&gt; 中断处理程序 -&gt; 网卡软中断 -&gt; 内核协议栈 -&gt; 网络协议栈 -&gt; 应用程序的路径太长，导致网络包处理难以优化。</p>
</blockquote>
<p>DPDK（Data Plane Development Kit，数据平面开发套件）是用户态网络标准，其跳过内核协议栈、由用户态进程轮询处理网络接收：</p>
<ul>
<li><p>PPS 非常高的场景中，查询时间比实际工作时间少很多，绝大部分时间都能处理网络包。</p>
</li>
<li><p>跳过内核协议栈后省去了繁杂的处理路径，应用程序可针对具体场景优化网络包处理逻辑，不需要关注所有细节。</p>
</li>
<li><p>通过大页、CPU 绑定、内存对齐、流水线并发等多种机制，优化网络包的处理效率。</p>
</li>
</ul>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/PR-3303.png" alt="pr-3303" style="zoom:67%;" /></p>
<p>XDP（eXpress Data Path）：是 Linux 内核提供的高性能网络数据路径，它允许网络包在进入内核协议栈之前就进行处理。XDP 底层和 bcc-tools 一样，都是基于 Linux 内核的 eBPF 机制实现。其对内核的要求比较高（Linux 4.8+），并且不提供缓存队列。基于 XDP 的应用程序通常是专用的网络应用，如 IDS（入侵检测系统）、DDoS 防御、 cilium 容器网络插件等。</p>
<p><img src="http://www.iovisor.org/wp-content/uploads/sites/8/2016/09/xdp-packet-processing-1024x560.png" alt="XDP Packet Processing" style="zoom: 80%;" /></p>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><h3 id="基准测试"><a href="#基准测试" class="headerlink" title="基准测试"></a>基准测试</h3><p>测试前应确定待评估的应用程序网络性能属于协议栈哪一层。</p>
<h3 id="转发性能"><a href="#转发性能" class="headerlink" title="转发性能"></a>转发性能</h3><p>包括网络接口层和网络层，通常关注每秒可处理的网络包数 PPS，特别是 64B 小包的处理能力。</p>
<p>使用 <code>hping3</code> 工具可测试网络包处理能力的性能，但更常用的是内核自带的 pktgen，其作为一个内核线程运行，需要加载 pktgen 内核模块后再通过 <code>/proc</code> 文件系统来交互：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要配置 pktgen 内核模块（即 CONFIG_NET_PKTGEN=m）后重新编译内核才可以使用。</span></span><br><span class="line">modprobe pktgen</span><br><span class="line"></span><br><span class="line">ps -ef | grep pktgen | grep -v grep</span><br><span class="line"><span class="meta">#</span><span class="bash"> root     26384     2  0 06:17 ?        00:00:00 [kpktgend_0]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> root     26385     2  0 06:17 ?        00:00:00 [kpktgend_1]</span></span><br><span class="line"></span><br><span class="line">ls /proc/net/pktgen/</span><br><span class="line"><span class="meta">#</span><span class="bash"> kpktgend_0  kpktgend_1  pgctrl</span></span><br></pre></td></tr></table></figure>
<p>pktgen 在每个 CPU 上启动一个内核线程，可通过 <code>/proc/net/pktgen</code> 下的同名文件与线程交互；<code>pgctrl</code> 用于开启和停止测试。</p>
<p>假设一台机器通过 eth0 网卡向另一台机器发包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义一个工具函数，方便后面配置各种测试选项</span></span><br><span class="line">function pgset() &#123;</span><br><span class="line">    local result</span><br><span class="line">    echo $1 &gt; $PGDEV</span><br><span class="line"></span><br><span class="line">    result=`cat $PGDEV | fgrep &quot;Result: OK:&quot;`</span><br><span class="line">    if [ &quot;$result&quot; = &quot;&quot; ]; then</span><br><span class="line">         cat $PGDEV | fgrep Result:</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为 0 号线程绑定 eth0 网卡</span></span><br><span class="line">PGDEV=/proc/net/pktgen/kpktgend_0</span><br><span class="line">pgset &quot;rem_device_all&quot;   # 清空网卡绑定</span><br><span class="line">pgset &quot;add_device eth0&quot;  # 添加eth0网卡</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 eth0 网卡的测试选项</span></span><br><span class="line">PGDEV=/proc/net/pktgen/eth0</span><br><span class="line">pgset &quot;count 1000000&quot;    # 总发包数量</span><br><span class="line">pgset &quot;delay 5000&quot;       # 不同包之间的发送延迟(单位纳秒)</span><br><span class="line">pgset &quot;clone_skb 0&quot;      # SKB包复制</span><br><span class="line">pgset &quot;pkt_size 64&quot;      # 网络包大小</span><br><span class="line">pgset &quot;dst 192.168.0.30&quot; # 目的IP</span><br><span class="line">pgset &quot;dst_mac 11:11:11:11:11:11&quot;  # 目的MAC</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动测试</span></span><br><span class="line">PGDEV=/proc/net/pktgen/pgctrl</span><br><span class="line">pgset &quot;start&quot;</span><br></pre></td></tr></table></figure>
<p>一段时间测试完成后，可以从 <code>/proc</code> 获取结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/net/pktgen/eth0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Params: count 1000000  min_pkt_size: 64  max_pkt_size: 64</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      frags: 0  delay: 0  clone_skb: 0  ifname: eth0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      flows: 0 flowlen: 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试进度，packts so far（pkts-sofar）表示已经发送了 100 万个包。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Current:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      pkts-sofar: 1000000  errors: 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      started: 1534853256071us  stopped: 1534861576098us idle: 70673us</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试结果，包含测试所用时间、网络包数量和分片、PPS、吞吐量以及错误数。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Result: OK: 8320027(c8249354+d70673) usec, 1000000 (64byte,0frags)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   120191pps 61Mb/sec (61537792bps) errors: 0</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试结果：PPS 为 120k，吞吐量为 61Mb/s，无发生错误。</span></span><br></pre></td></tr></table></figure>
<p>测试结果可以参照千兆交换机的 PPS：线速（满负载、无差错转发）PPS 即 1000Mbit 除以以太网帧的大小，<code>1000Mbps/((64+20)*8bit) = 1.5 Mpps</code>（20B 为以太网帧前导和帧间距的大小）。</p>
<h3 id="TCP-UDP-性能"><a href="#TCP-UDP-性能" class="headerlink" title="TCP/UDP 性能"></a>TCP/UDP 性能</h3><p>一些应用直接基于 TCP/UDP 构建服务，适合使用 <code>iperf</code> 和 <code>netperf</code> 测试吞吐量。安装 iperf3：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt -y install iperf3</span><br></pre></td></tr></table></figure>
<p>目标机器上启动 iperf3 服务端：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -s 启动服务端，-i 汇报间隔，-p 监听端口</span></span><br><span class="line">iperf3 -s -i 1 -p 10000</span><br></pre></td></tr></table></figure>
<p>在另一台机器上运行 iperf3 客户端：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -c 启动客户端（指定目标服务器 ip），-b 目标带宽(单位是bits/s)，-t 表示测试时间，-P 并发数，-p 目标服务器监听端口</span></span><br><span class="line">iperf3 -c 192.168.0.30 -b 1G -t 15 -P 2 -p 10000</span><br></pre></td></tr></table></figure>
<p>在服务端上查看输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> [ ID] Interval           Transfer     Bandwidth</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> [SUM]   0.00-15.04  sec  0.00 Bytes  0.00 bits/sec                  sender</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> [SUM]   0.00-15.04  sec  1.51 GBytes   860 Mbits/sec                receiver</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试结果：TCP 接收的带宽（吞吐量）为 860 Mb/s</span></span><br></pre></td></tr></table></figure>
<h3 id="HTTP-性能"><a href="#HTTP-性能" class="headerlink" title="HTTP 性能"></a>HTTP 性能</h3><p><code>webbench</code>、<code>ab</code>（Apache 自带）等都是常用的 HTTP 压力测试工具，主要测试 HTTP 服务的每秒请求数、请求延迟、吞吐量以及请求延迟的分布情况等。安装 ab：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y apache2-utils</span><br><span class="line"><span class="meta">#</span><span class="bash"> CentOS: yum install -y httpd-tools</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>ab</code> 测试 Nginx 性能：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -c 并发请求数，-n 总请求数</span></span><br><span class="line">ab -c 1000 -n 10000 http://192.168.0.30/</span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server Software:        nginx/1.15.8</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server Hostname:        192.168.0.30</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server Port:            80</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 请求汇总</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     每秒处理请求数。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Requests per second:    1078.54 [<span class="comment">#/sec] (mean)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">     平均延迟，包括线程运行的调度时间和网络请求响应时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Time per request:       927.183 [ms] (mean)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     实际请求的响应时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Time per request:       0.927 [ms] (mean, across all concurrent requests)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     吞吐量。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Transfer rate:          890.00 [Kbytes/sec] received</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接时间汇总</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Connection Times (ms)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               min  mean[+/-sd] median   max</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Connect:        0   27 152.1      1    1038    <span class="comment"># 连接</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Processing:     9  207 843.0     22    9242    <span class="comment"># 处理</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Waiting:        8  207 843.0     22    9242    <span class="comment"># 等待</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Total:         15  233 857.7     23    9268    <span class="comment"># 总</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 请求延迟汇总（百分位数）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Percentage of the requests served within a certain time (ms)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   50%     23    50% 的请求可在 23ms 内完成</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   66%     24</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   75%     24</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   80%     26</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   90%    274</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   95%   1195</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   98%   2335</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   99%   4663</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  100%   9268 (longest request)</span></span><br></pre></td></tr></table></figure>
<h3 id="应用负载性能"><a href="#应用负载性能" class="headerlink" title="应用负载性能"></a>应用负载性能</h3><p>工具本身的性能对测试至关重要。通过以上工具测试不能直接表示应用程序的实际性能，其与用户的实际请求很可能不一致。比如用户请求往往附带各种负载（payload），会影响 Web 应用程序内部的处理逻辑从而影响最终性能。</p>
<p>因此测试还要求性能工具本身可以模拟用户的请求负载，常用的工具有 wrk、TCPCopy、Jmeter、LoadRunner 等（后两者甚至提供脚本录制、回放、GUI 等功能）。</p>
<p>wrk 内置 LuaJIT，可以用来实现复杂场景的性能测试。在调用 Lua 脚本时可将 HTTP 请求分为三个阶段，即 setup、running、done：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">setup:</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">|         setup(trread)          | 每个线程执行一次</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="section">running:</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">|          init(args)            | 每个线程执行一次</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">|             delay()            | &#123;</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">|            request()           |     每次请求调用</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">|  response(status,header,body)  | &#125;</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="section">done:</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br><span class="line"><span class="section">| done(summary,latency,requests) | 整个过程执行一次</span></span><br><span class="line"><span class="section">+--------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>比如可以在 setup 阶段，为请求设置认证参数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- auth.lua</span></span><br><span class="line"><span class="comment">-- example script that demonstrates response handling and</span></span><br><span class="line"><span class="comment">-- retrieving an authentication token to set on all future</span></span><br><span class="line"><span class="comment">-- requests</span></span><br><span class="line">token = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">path</span>  = <span class="string">&quot;/authenticate&quot;</span></span><br><span class="line"></span><br><span class="line">request = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">   <span class="keyword">return</span> wrk.<span class="built_in">format</span>(<span class="string">&quot;GET&quot;</span>, <span class="built_in">path</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">response = <span class="function"><span class="keyword">function</span><span class="params">(status, headers, body)</span></span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> token <span class="keyword">and</span> <span class="built_in">status</span> == <span class="number">200</span> <span class="keyword">then</span></span><br><span class="line">      token = headers[<span class="string">&quot;X-Token&quot;</span>]</span><br><span class="line">      <span class="built_in">path</span>  = <span class="string">&quot;/resource&quot;</span></span><br><span class="line">      wrk.headers[<span class="string">&quot;X-Token&quot;</span>] = token</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>再启动测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 源码安装</span></span><br><span class="line">cd wrk</span><br><span class="line">apt  -y install build-essential</span><br><span class="line">make</span><br><span class="line">cp wrk /usr/local/bin/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -c 并发连接数，-t 线程数</span></span><br><span class="line">wrk -c 1000 -t 2 -s auth.lua http://192.168.0.30/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Running 10s <span class="built_in">test</span> @ http://192.168.0.30/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   2 threads and 1000 connections</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   Thread Stats   Avg      Stdev     Max   +/- Stdev</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     Latency    65.83ms  174.06ms   1.99s    95.85%</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     Req/Sec     4.87k   628.73     6.78k    69.00%</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   96954 requests <span class="keyword">in</span> 10.06s, 78.59MB <span class="built_in">read</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   Socket errors: connect 0, <span class="built_in">read</span> 0, write 0, timeout 179</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Requests/sec:   9641.31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Transfer/sec:      7.82MB</span></span><br></pre></td></tr></table></figure>
<h2 id="优化总结"><a href="#优化总结" class="headerlink" title="优化总结"></a>优化总结</h2><p>性能优化首先是要确定目标，不同应用中每个指标的优化标准、优先级都不同：</p>
<ul>
<li><p>对于 NAT 网关而言，其直接影响整个数据中心的网络出入性能，所以通常需要达到或接近线性转发，PPS 是最主要的性能目标。</p>
</li>
<li><p>对于数据库、缓存等系统而言，目的是快速完成网络收发，即延迟是主要的性能目标。</p>
</li>
<li><p>对于 Web 服务而言，需要同时兼顾吞吐量和延迟。</p>
</li>
</ul>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>即优化 I/O 模型、工作模型以及应用层网络协议。</p>
<p><strong>选用网络模型</strong>：</p>
<ul>
<li><p>使用 I/O 多路复用 epoll 取代 select 和 poll。</p>
</li>
<li><p>使用异步 I/O（比较复杂）。</p>
</li>
</ul>
<p><strong>选用工作模型</strong>：</p>
<ul>
<li><p>主进程（管理网络连接）+ 多个 worker 子进程（实际的业务处理）。</p>
</li>
<li><p>监听到相同端口的多进程模型。所有进程监听相同接口，开启 SO_REUSEPORT 选项，由内核负责进程的负载均衡。</p>
</li>
</ul>
<p><strong>协议优化</strong>：</p>
<ul>
<li><p>使用长连接取代短连接：可显著降低 TCP 连接建立成本，在每秒请求次数较多时效果非常明显。</p>
</li>
<li><p>使用内存来缓存不常变化的数据：可降低网络 I/O 次数，同时加快应用程序的响应速度。</p>
</li>
<li><p>使用 Protocol Buffer 等序列化的方式，压缩网络 I/O 的数据量，可提高应用程序的吞吐。</p>
</li>
<li><p>使用 DNS 缓存、预取、HTTPDNS 等方式减少 DNS 解析的延迟，并提升网络 I/O 整体速度。</p>
</li>
</ul>
<h3 id="套接字层"><a href="#套接字层" class="headerlink" title="套接字层"></a>套接字层</h3><p>为了提高网络的吞吐量，通常需要调整缓冲区的大小。</p>
<ul>
<li><p>增大每个套接字的缓冲区大小 net.core.optmem_max。</p>
</li>
<li><p>增大套接字接收缓冲区大小 net.core.rmem_max 和发送缓冲区大小 net.core.wmem_max。</p>
</li>
<li><p>增大 TCP 接收缓冲区大小 net.ipv4.tcp_rmem 和发送缓冲区大小 net.ipv4.tcp_wmem（三个数值分别是 min，default，max，系统会根据设置自动调整 TCP 接收 / 发送缓冲区的大小，UDP 同理）。</p>
</li>
</ul>
<p>修改网络连接行为的配置项：</p>
<ul>
<li><p>为 TCP 连接设置 TCP_NODELAY 可禁用 Nagle 算法。</p>
</li>
<li><p>为 TCP 连接开启 TCP_CORK 可让小包聚合成大包后再发送（会阻塞小包发送）。</p>
</li>
<li><p>使用 SO_SNDBUF 和 SO_RCVBUF  可分别调整套接字发送缓冲区和接收缓冲区大小。</p>
</li>
</ul>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><p>主要时优化 TCP 和 UDP 协议。首先要了解 TCP 基本原理（比如流量控制、慢启动、拥塞避免、延迟确认）以及状态流转：</p>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/c072bb9c9dfd727ed187bc24beb3e3d1.png" alt="img" style="zoom:67%;" /></p>
<h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p><strong>TIME_WAIT 状态优化</strong>：对于请求量较大的场景，可能会看到大量处于 TIME_WAIT 状态的连接占用内存和端口资源。</p>
<ul>
<li><p>增大处于 TIME_WAIT 状态的连接数量 net.ipv4.tcp_max_tw_buckets ，并增大连接跟踪表的大小 net.netfilter.nf_conntrack_max。</p>
</li>
<li><p>减小 net.ipv4.tcp_fin_timeout 和 net.netfilter.nf_conntrack_tcp_timeout_time_wait ，让系统尽快释放其所占用的资源。</p>
</li>
<li><p>开启端口复用 net.ipv4.tcp_tw_reuse。被 TIME_WAIT 状态占用的端口还能用到新连接中。增大本地端口的范围 net.ipv4.ip_local_port_range 以支持更多连接、提高整体并发能力。</p>
</li>
<li><p>增加最大文件描述符数量。使用 fs.nr_open 和 fs.file-max 分别增大进程和系统的最大文件描述符数；或在应用程序的 systemd 配置文件中设置应用程序的最大文件描述符数 LimitNOFILE。</p>
</li>
</ul>
<p><strong>缓解 SYN FLOOD</strong>：</p>
<ul>
<li><p>增大 TCP 半连接最大数量 net.ipv4.tcp_max_syn_backlog ，或开启 TCP SYN Cookies net.ipv4.tcp_syncookies 绕开半连接数量限制（不可同时使用）。</p>
</li>
<li><p>减少 SYN_RECV 状态连接重传 SYN+ACK 包次数 net.ipv4.tcp_synack_retries。</p>
</li>
</ul>
<p><strong>Keepalive 优化</strong>：长连接场景通常使用 Keepalive 检测 TCP 连接状态，以便对端连接断开后自动回收。系统默认的 Keepalive 探测间隔和重试次数一般无法满足应用程序的性能要求。</p>
<ul>
<li><p>缩短最后一次数据包到 Keepalive 探测包的间隔时间 net.ipv4.tcp_keepalive_time。</p>
</li>
<li><p>缩短发送 Keepalive 探测包的间隔时间 net.ipv4.tcp_keepalive_intvl。</p>
</li>
<li><p>减少 Keepalive 探测失败后，一直到通知应用程序前的重试次数 net.ipv4.tcp_keepalive_probes。</p>
</li>
</ul>
<h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><ul>
<li><p>增大套接字缓冲区大小以及 UDP 缓冲区范围。</p>
</li>
<li><p>增大本地端口号的范围。</p>
</li>
<li><p>根据 MTU 大小调整 UDP 数据包大小，减少或避免分片。</p>
</li>
</ul>
<blockquote>
<p>  需要注意优化手段之间的冲突，比如服务器端开启 Nagle 算法、客户端开启延迟确认，很容易导致网络延迟增大；在 NAT 服务器上开启 net.ipv4.tcp_tw_recycle 容易导致各种连接失败。</p>
</blockquote>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>主要是对路由、 IP 分片以及 ICMP 等进行调优。</p>
<p>从路由和转发的角度出发：</p>
<ul>
<li><p>在需要转发的服务器中（比如 NAT 网关或使用 Docker 容器时），开启 IP 转发，即设置 net.ipv4.ip_forward = 1。</p>
</li>
<li><p>调整数据包的生存周期 TTL，比如设置 net.ipv4.ip_default_ttl = 64。而增大该值会降低系统性能。</p>
</li>
<li><p>开启数据包的反向地址校验，比如设置 net.ipv4.conf.eth0.rp_filter = 1。可以防止 IP 欺骗，并减少伪造 IP 带来的 DDoS 问题。</p>
</li>
</ul>
<p>从分片的角度出发：最主要是调整 MTU 的大小。</p>
<ul>
<li><p>通常根据以太网标准设置，网络帧最大为 1518B，去掉以太网头部 18B 后剩余 1500 即为 MTU。在使用 VXLAN、GRE 等叠加网络技术会使原来的网络包变大，MTU 也要相应增大。</p>
</li>
<li><p>很多网络设备支持巨帧，还可以把 MTU 调大为 9000，以提高网络吞吐量。</p>
</li>
</ul>
<blockquote>
<p>  比如使用 VXLAN，在原来报文的基础上，增加了 14B 的以太网头部、 8B 的 VXLAN 头部、8B 的 UDP 头部以及 20B 的 IP 头部，因此交换机、路由器等的 MTU 要增大到 1550，或封包前的 MTU（比如虚拟化环境中的虚拟网卡）缩小到 1450。</p>
</blockquote>
<p>从 ICMP 的角度出发：为避免 ICMP 主机探测、ICMP Flood 等网络问题，可通过内核选项限制 ICMP 行为。</p>
<ul>
<li><p>禁止 ICMP 协议，即设置 net.ipv4.icmp_echo_ignore_all = 1，外部主机无法通过 ICMP 探测主机。</p>
</li>
<li><p>禁止广播 ICMP，即设置 net.ipv4.icmp_echo_ignore_broadcasts = 1。</p>
</li>
</ul>
<h3 id="链路层"><a href="#链路层" class="headerlink" title="链路层"></a>链路层</h3><p>主要是优化网络包的收发、网络功能卸载以及网卡选项。</p>
<p>网卡收包后调用中断处理程序（特别是软中断）需要消耗大量的 CPU，而将中断处理程序调度到不同的 CPU 上执行可以显著提高网络吞吐量。</p>
<ul>
<li><p>为网卡硬中断配置 CPU 亲和性（smp_affinity），或者开启 irqbalance 服务。</p>
</li>
<li><p>开启 RPS（Receive Packet Steering）和 RFS（Receive Flow Steering），将应用程序和软中断的处理调度到相同 CPU 上，可以增加 CPU 缓存命中率，减少网络延迟。</p>
</li>
</ul>
<p>利用网卡的功能：在内核中通过软件处理的功能转移到网卡中。</p>
<ul>
<li><p>TSO（TCP Segmentation Offload）和 UFO（UDP Fragmentation Offload）：在 TCP/UDP 协议中直接发送大包；而 TCP 包的分段（按照 MSS 分段）和 UDP 的分片（按照 MTU 分片）功能由网卡来完成 。</p>
</li>
<li><p>GSO（Generic Segmentation Offload）：在网卡不支持 TSO/UFO 时，将 TCP/UDP 包的分段延迟到进入网卡前再执行。可以减少 CPU 的消耗，以及在发生丢包时只重传分段后的包。</p>
</li>
<li><p>LRO（Large Receive Offload）：在接收 TCP 分段包时，由网卡将其组装合并后再交给上层网络处理。在需要 IP 转发时下不能开启 LRO，如果多个包的头部信息不一致，LRO 合并会导致网络包的校验错误。</p>
</li>
<li><p>GRO（Generic Receive Offload）：修复了 LRO 的缺陷并且更为通用，同时支持 TCP 和 UDP。</p>
</li>
<li><p>RSS（Receive Side Scaling）：也称为多队列接收，基于硬件的多个接收队列来分配网络接收进程，使得让多个 CPU 来处理接收到的网络包。</p>
</li>
<li><p>VXLAN 卸载：让网卡完成 VXLAN 的组包功能。</p>
</li>
</ul>
<p>优化网络接口：可提升网络吞吐量。</p>
<ul>
<li><p>开启网络接口的多队列功能。每个队列可以用不同的中断号调度到不同 CPU 上执行，从而提升网络的吞吐量。</p>
</li>
<li><p>增大网络接口的缓冲区大小以及队列长度等，提升网络传输的吞吐量（可能导致延迟增大）。</p>
</li>
<li><p>使用 Traffic Control 工具为不同网络流量配置 QoS。</p>
</li>
</ul>
<p>绕过内核协议栈：</p>
<ul>
<li><p>DPDK：跳过内核协议栈，直接由用户态进程轮询处理网络请求。再结合大页、CPU 绑定、内存对齐、流水线并发等多种机制，优化网络包的处理效率。</p>
</li>
<li><p>XDP：内核自带，在网络包进入内核协议栈前就对其进行处理。</p>
</li>
</ul>
<p>关于工具和参数的选用，可以参考下表：</p>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/a1eb07e281e5795be83c11d7255c543b.png" alt="img" style="zoom:67%;" /></p>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/0d87b39b89a1b7f325fc5477c0182ea0.png" alt="img" style="zoom:67%;" /></p>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/5f2d4957663dd8bf3410da8180ab18f0.png" alt="img" style="zoom:67%;" /></p>
<p><img src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/OS_linux-network-monitoring.assets/b07ea76a8737ed93395736795ede44e0.png" alt="img" style="zoom:67%;" /></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>分析案例可参考：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/81850">37 | 案例篇：DNS 解析时快时慢，我该怎么办？</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/82321">38 | 案例篇：怎么使用 tcpdump 和 Wireshark 分析网络流量？</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/82573">39 | 案例篇：怎么缓解 DDoS 攻击带来的性能下降问题？</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/82833">40 | 案例篇：网络请求延迟变大了，我该怎么办？</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/83189">41 | 案例篇：如何优化 NAT 性能？（上）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/83520">42 | 案例篇：如何优化 NAT 性能？（下）</a></p>
</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
    </article>
    <!-- license -->
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2021/04/10/OS_linux-cpu-monitoring/" title="Linux CPU 原理与分析">
                    <div class="nextTitle">Linux CPU 原理与分析</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2021/04/01/OS_system_initialization/" title="Linux - 架构与系统初始化">
                    <div class="prevTitle">Linux - 架构与系统初始化</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

    <div id="lv-container" data-id="city" data-uid= MTAyMC80ODYzMi8yNTEyNg==>
        <script type="text/javascript">
            (function (d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活 JavaScript</noscript>
    </div>


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:yipwinghong@outlook.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/yipwinghong" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="https://ywh-oss.oss-cn-shenzhen.aliyuncs.com/WeChat.jpg" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://www.v2ex.com/member/yipwinghong" class="iconfont-archer v2ex" target="_blank" title=v2ex></a>
            
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:0vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">Linux 网络原理与分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">网络模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%94%B6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">网络收发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8C%85%E6%8E%A5%E6%94%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">网络包接收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8C%85%E5%8F%91%E9%80%81"><span class="toc-number">1.2.2.</span> <span class="toc-text">网络包发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.2.3.</span> <span class="toc-text">套接字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">1.3.</span> <span class="toc-text">性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.2.</span> <span class="toc-text">套接字信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%A0%88%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.3.</span> <span class="toc-text">协议栈信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%B4%A8%E9%87%8F%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.4.</span> <span class="toc-text">网络质量统计信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">优化方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#I-O-%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.1.</span> <span class="toc-text">I&#x2F;O 模型优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.2.</span> <span class="toc-text">工作模型优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%BF%9B%E7%A8%8B-%E5%A4%9A%E4%B8%AA-worker-%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">主进程 + 多个 worker 子进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%88%B0%E7%9B%B8%E5%90%8C%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">监听到相同端口的多进程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DPDK-%E5%92%8C-XDP"><span class="toc-number">1.4.3.</span> <span class="toc-text">DPDK 和 XDP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.</span> <span class="toc-text">性能测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">基准测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.2.</span> <span class="toc-text">转发性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-UDP-%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.3.</span> <span class="toc-text">TCP&#x2F;UDP 性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.4.</span> <span class="toc-text">HTTP 性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E8%B4%9F%E8%BD%BD%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.5.</span> <span class="toc-text">应用负载性能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.</span> <span class="toc-text">优化总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-number">1.6.1.</span> <span class="toc-text">应用层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E5%B1%82"><span class="toc-number">1.6.2.</span> <span class="toc-text">套接字层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-number">1.6.3.</span> <span class="toc-text">传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">TCP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">UDP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.6.4.</span> <span class="toc-text">网络层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="toc-number">1.6.5.</span> <span class="toc-text">链路层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.7.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 78
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/10</span>
            <a class="archive-post-title" href="/2021/12/10/Go_engineering-specification-design/">Go 工程化规范设计</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/06</span>
            <a class="archive-post-title" href="/2021/11/06/Go_modules_management/">Go Modules 管理总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/15</span>
            <a class="archive-post-title" href="/2021/10/15/Go_concurrency_primitives/">Go 并发原语</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/10</span>
            <a class="archive-post-title" href="/2021/10/10/Design_data-lineage/">数据血缘功能设计</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/26</span>
            <a class="archive-post-title" href="/2021/09/26/2021-09-26_diary/">迟来的一次复盘</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span>
            <a class="archive-post-title" href="/2021/09/12/DB_mysql-optimization-basic/">MySQL 性能优化基础</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/05</span>
            <a class="archive-post-title" href="/2021/09/05/DB_b-trees-more-than-i-thought-id-want-to-know/">关于 B-Trees 的更多细节（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/11</span>
            <a class="archive-post-title" href="/2021/08/11/Go_microservices_availability_design/">微服务可用性设计</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/10</span>
            <a class="archive-post-title" href="/2021/08/10/Algorithm_reliable-distributed-timer/">可靠的分布式计时器（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/04</span>
            <a class="archive-post-title" href="/2021/08/04/Go_engineering-standard/">Go 工程化标准实践</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/31</span>
            <a class="archive-post-title" href="/2021/07/31/Go_memory-model/">Go 内存模型（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/28</span>
            <a class="archive-post-title" href="/2021/07/28/Go_channel-applications/">Go Channel 应用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/25</span>
            <a class="archive-post-title" href="/2021/07/25/Fenix_build-services/">《凤凰架构》阅读笔记（五）：服务构建与流量治理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/23</span>
            <a class="archive-post-title" href="/2021/07/23/Fenix_transparent-multilevel-diversion-system/">《凤凰架构》阅读笔记（四）：透明多级分流系统</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span>
            <a class="archive-post-title" href="/2021/07/22/Fenix_transaction/">《凤凰架构》阅读笔记（三）：事务处理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/21</span>
            <a class="archive-post-title" href="/2021/07/21/Fenix_access-remote-service/">《凤凰架构》阅读笔记（二）：访问远程服务</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span>
            <a class="archive-post-title" href="/2021/07/18/Go_error_handling/">Go 异常处理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/15</span>
            <a class="archive-post-title" href="/2021/07/15/Fenix_architecture-evolution/">《凤凰架构》阅读笔记（一）：软件架构演进</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/12</span>
            <a class="archive-post-title" href="/2021/07/12/Go_microservices_governance/">微服务概览与治理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span>
            <a class="archive-post-title" href="/2021/07/09/Algorithm_max-flow-problem/">最大流问题</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2021/07/08/Algorithm_minimum_spanning_tree_problem/">最小生成树问题</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2021/07/08/Algorithm_shortest-path-problem/">最短路径问题</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/01</span>
            <a class="archive-post-title" href="/2021/07/01/DistributedSystem_gossip-dissemination/">分布式系统模式：Gossip 传播（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/23</span>
            <a class="archive-post-title" href="/2021/06/23/DistributedSystem_versioned-value/">分布式系统模式：版本化值（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/19</span>
            <a class="archive-post-title" href="/2021/06/19/Algorithm_consistent-hashing/">一致性哈希（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/13</span>
            <a class="archive-post-title" href="/2021/06/13/Go_cheat-sheet/">Go Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/10</span>
            <a class="archive-post-title" href="/2021/06/10/Go_a-tour-of-go/">A tour of Go</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/06</span>
            <a class="archive-post-title" href="/2021/06/06/2021-06-06_diary/">Weekly Summary (2021-05-31_2021-06-06)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/05</span>
            <a class="archive-post-title" href="/2021/06/05/2021-06-05_diary/">基于记忆规律的学习方法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2021/05/31/2021-05-31_diary/">2021 下半年工作学习安排</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/16</span>
            <a class="archive-post-title" href="/2021/05/16/Algorithm_how-to-solve-the-secret-santa-problem-using-graph-theory/">如何用图论解决 Secret Santa 问题？（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/12</span>
            <a class="archive-post-title" href="/2021/05/12/DB_using-postgresql-as-a-data-warehouse/">把 PostgreSQL 用作数据仓库（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/28</span>
            <a class="archive-post-title" href="/2021/04/28/OS_linux-memory-monitoring/">Linux 内存原理与分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/20</span>
            <a class="archive-post-title" href="/2021/04/20/OS_linux-io-monitoring/">Linux I/O 原理与分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/10</span>
            <a class="archive-post-title" href="/2021/04/10/OS_linux-cpu-monitoring/">Linux CPU 原理与分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span>
            <a class="archive-post-title" href="/2021/04/05/OS_linux-network-monitoring/">Linux 网络原理与分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2021/04/01/OS_system_initialization/">Linux - 架构与系统初始化</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/17</span>
            <a class="archive-post-title" href="/2021/03/17/Java_cpp-for-java-programmers/">Java 程序员的 C++（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/24</span>
            <a class="archive-post-title" href="/2021/02/24/DDIA_note-13/">《DDIA》阅读笔记（九）：一致性与共识（共识问题）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/2021/02/21/2021-02-21_diary/">近期工作学习规划</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/19</span>
            <a class="archive-post-title" href="/2021/02/19/DDIA_note-12/">《DDIA》阅读笔记（九）：一致性与共识（顺序保证）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/13</span>
            <a class="archive-post-title" href="/2021/02/13/DDIA_note-11/">《DDIA》阅读笔记（九）：一致性与共识（可线性化）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span>
            <a class="archive-post-title" href="/2021/02/06/DDIA_note-10/">《DDIA》阅读笔记（八）：分布式系统的挑战</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/27</span>
            <a class="archive-post-title" href="/2021/01/27/DDIA_note-9/">《DDIA》阅读笔记（七）：事务</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/22</span>
            <a class="archive-post-title" href="/2021/01/22/DDIA_note-8/">《DDIA》阅读笔记（六）：数据分区</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/21</span>
            <a class="archive-post-title" href="/2021/01/21/DDIA_note-7/">《DDIA》阅读笔记（五）：数据复制（无主节点）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/20</span>
            <a class="archive-post-title" href="/2021/01/20/DDIA_note-6/">《DDIA》阅读笔记（五）：数据复制（多主节点）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/10</span>
            <a class="archive-post-title" href="/2021/01/10/DB_right-database/">选择合适的数据库（译）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/09</span>
            <a class="archive-post-title" href="/2021/01/09/DDIA_note-5/">《DDIA》阅读笔记（五）：数据复制（单主节点）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span>
            <a class="archive-post-title" href="/2021/01/01/DB_tree-table-design-summary/">树形表结构设计总结</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/13</span>
            <a class="archive-post-title" href="/2020/12/13/DDIA_note-3/">《DDIA》阅读笔记（三）：数据存储与检索</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/04</span>
            <a class="archive-post-title" href="/2020/12/04/DDIA_note-2/">《DDIA》阅读笔记（二）：数据模型与查询语言</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/02</span>
            <a class="archive-post-title" href="/2020/12/02/DDIA_note-1/">《DDIA》阅读笔记（一）：可靠、可扩展与可维护的应用系统</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/08</span>
            <a class="archive-post-title" href="/2020/10/08/Maven_external_dependencies_management/">Maven 打包依赖外置</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/2020/10/04/Java_prod-analysis-cmd/">Java 应用常用调试分析方法总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/24</span>
            <a class="archive-post-title" href="/2020/09/24/Kafka_cheat-sheet/">Kafka Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/2020/08/09/Arthas_cheat-sheet/">Arthas Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/12</span>
            <a class="archive-post-title" href="/2020/07/12/Java_override-and-bridge-method/">Java 多态、重写与桥接方法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/30</span>
            <a class="archive-post-title" href="/2020/06/30/Java_memory-area/">Java 内存区域</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span>
            <a class="archive-post-title" href="/2020/05/28/DB_data-warehouse-design-basic/">数据仓库设计基础</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/08</span>
            <a class="archive-post-title" href="/2020/04/08/2020-04-08_diary/">关于使用思维导图做笔记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/28</span>
            <a class="archive-post-title" href="/2020/03/28/Algorithm_leetcode-high-frequency-problems/">LeetCode 高频面试题</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/06</span>
            <a class="archive-post-title" href="/2020/03/06/InfoSecty_personal-infomation-security-guide/">個人信息安全保護指南</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/22</span>
            <a class="archive-post-title" href="/2020/02/22/2020-02-22_diary/">免费 JetBrains 全家桶</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/16</span>
            <a class="archive-post-title" href="/2020/02/16/Nginx_cheat-sheet/">Nginx Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/15</span>
            <a class="archive-post-title" href="/2020/02/15/Git_cheat-sheet/">Git Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/15</span>
            <a class="archive-post-title" href="/2020/02/15/Docker&K8S_cheat-sheet/">Docker & K8S Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/03</span>
            <a class="archive-post-title" href="/2020/02/03/Java_jstat-monitor-analysis/">JVM jstat 监控分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/01</span>
            <a class="archive-post-title" href="/2020/02/01/Java_GC-log-analysis/">JVM GC 日志分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span>
            <a class="archive-post-title" href="/2020/01/01/Java_JVM_mindmap/">Java 虚拟机与并发编程</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/05</span>
            <a class="archive-post-title" href="/2019/12/05/Design_design-patterns/">设计模式与设计原则</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span>
            <a class="archive-post-title" href="/2019/10/04/Python_async-programming/">Python 异步编程总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/19</span>
            <a class="archive-post-title" href="/2019/09/19/Python_data-structure/">Python 数据结构应用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span>
            <a class="archive-post-title" href="/2019/09/13/Python_decorator/">Python 装饰器基本用法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/22</span>
            <a class="archive-post-title" href="/2019/08/22/Python_OOP-summary/">Python 类与对象总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/28</span>
            <a class="archive-post-title" href="/2019/06/28/JavaScript_cheat-sheet/">JavaScript Cheat Sheet</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/02</span>
            <a class="archive-post-title" href="/2019/06/02/JavaScript_ES6-grammar/">ES6 语法总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/20</span>
            <a class="archive-post-title" href="/2019/05/20/Vue_user-guide/">Vue 学习笔记</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="杂事">
                <span class="iconfont-archer">&#xe606;</span>
                杂事
            </span>
        
            <span class="sidebar-tag-name" data-tags="技术">
                <span class="iconfont-archer">&#xe606;</span>
                技术
            </span>
        
            <span class="sidebar-tag-name" data-tags="算法">
                <span class="iconfont-archer">&#xe606;</span>
                算法
            </span>
        
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
        
            <span class="sidebar-tag-name" data-tags="数据库">
                <span class="iconfont-archer">&#xe606;</span>
                数据库
            </span>
        
            <span class="sidebar-tag-name" data-tags="大数据">
                <span class="iconfont-archer">&#xe606;</span>
                大数据
            </span>
        
            <span class="sidebar-tag-name" data-tags="设计">
                <span class="iconfont-archer">&#xe606;</span>
                设计
            </span>
        
            <span class="sidebar-tag-name" data-tags="分布式系统">
                <span class="iconfont-archer">&#xe606;</span>
                分布式系统
            </span>
        
            <span class="sidebar-tag-name" data-tags="Docker">
                <span class="iconfont-archer">&#xe606;</span>
                Docker
            </span>
        
            <span class="sidebar-tag-name" data-tags="Kubernetes">
                <span class="iconfont-archer">&#xe606;</span>
                Kubernetes
            </span>
        
            <span class="sidebar-tag-name" data-tags="Go">
                <span class="iconfont-archer">&#xe606;</span>
                Go
            </span>
        
            <span class="sidebar-tag-name" data-tags="信息安全">
                <span class="iconfont-archer">&#xe606;</span>
                信息安全
            </span>
        
            <span class="sidebar-tag-name" data-tags="Maven">
                <span class="iconfont-archer">&#xe606;</span>
                Maven
            </span>
        
            <span class="sidebar-tag-name" data-tags="Nginx">
                <span class="iconfont-archer">&#xe606;</span>
                Nginx
            </span>
        
            <span class="sidebar-tag-name" data-tags="Linux">
                <span class="iconfont-archer">&#xe606;</span>
                Linux
            </span>
        
            <span class="sidebar-tag-name" data-tags="OS">
                <span class="iconfont-archer">&#xe606;</span>
                OS
            </span>
        
            <span class="sidebar-tag-name" data-tags="Python">
                <span class="iconfont-archer">&#xe606;</span>
                Python
            </span>
        
            <span class="sidebar-tag-name" data-tags="Git">
                <span class="iconfont-archer">&#xe606;</span>
                Git
            </span>
        
            <span class="sidebar-tag-name" data-tags="微服务">
                <span class="iconfont-archer">&#xe606;</span>
                微服务
            </span>
        
            <span class="sidebar-tag-name" data-tags="JavaScript">
                <span class="iconfont-archer">&#xe606;</span>
                JavaScript
            </span>
        
            <span class="sidebar-tag-name" data-tags="MySQL">
                <span class="iconfont-archer">&#xe606;</span>
                MySQL
            </span>
        
            <span class="sidebar-tag-name" data-tags="Kafka">
                <span class="iconfont-archer">&#xe606;</span>
                Kafka
            </span>
        
            <span class="sidebar-tag-name" data-tags="Vue">
                <span class="iconfont-archer">&#xe606;</span>
                Vue
            </span>
        
            <span class="sidebar-tag-name" data-tags="前端">
                <span class="iconfont-archer">&#xe606;</span>
                前端
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="《数据密集型应用系统设计》阅读笔记">
            <span class="iconfont-archer">&#xe60a;</span>
            《数据密集型应用系统设计》阅读笔记
        </span>
    
        <span class="sidebar-category-name" data-categories="《凤凰架构》阅读笔记">
            <span class="iconfont-archer">&#xe60a;</span>
            《凤凰架构》阅读笔记
        </span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://yipwinghong.github.io",
        root: siteMetaRoot,
        author: "Kylo Yip"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20211217"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20211217"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20211217" async></script>
        
        <!-- mermaid -->
        
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
